# 环带巡边寻路示例

本项目展示如何在网格地图上构建切比雪夫距离定义的矩形环带，并在环带内完成绕圈巡边寻路。实现基于 Python、NumPy 与 OpenCV，提供从掩膜构建、最近环带点搜索、A* 寻路到可视化绘制的完整流程。

## 算法概述

1. **环带构建**：使用 `build_ring_mask` 依据中心点 A 与内外半径计算布尔掩膜，距离衡量采用 L∞（切比雪夫）距离。
2. **最近点搜索**：`find_nearest_point_on_ring` 借助优先队列逐步扩张，寻找路径距离最短的环带可走点。
3. **极角排序**：`order_ring_points_cw_or_ccw` 通过 `atan2` 计算极角，实现顺/逆时针的环带点序列。
4. **A* 寻路**：`astar` 支持八方向移动并禁止对角穿越角落，确保路径合法。
5. **巡边拼接**：`trace_ring_path` 首先连接 A 与最近点，随后在环带内部按锚点数量（4 个或 8 个）逐段连接，必要时回退到全局可走掩膜确保完整绕行，并在元数据中保留完整密集路径。函数返回的为稀疏锚点列表，完整折线可从 `trace_ring_path.last_metadata["密集路径"]` 读取，锚点列表也同步存于 `trace_ring_path.last_metadata["锚点列表"]`。
6. **路径绘制**：`draw_path_on_image` 在原图上绘制路径折线，并标记起止点。

若环带与障碍导致局部不可达，算法会记录跳过点并尝试全局路径拼接；若整体不可行，则抛出中文错误提示。

## 运行示例

```bash
pip install numpy opencv-python
python demo_ring_nav.py
```

脚本将自动构造 60×60 像素的示例地图，并运行两组参数：

- 示例一：A=(30,30)、inner_r=5、outer_r=10、顺时针、锚点数=4（仅上下左右四点）；
- 示例二：A=(24,18)、inner_r=3、outer_r=8、逆时针、锚点数=8（含对角方向八点）。

运行完成后会打印中文日志（包含锚点列表与密集路径长度），并在仓库根目录生成 `demo_output.png`，展示两组路径（红色表示顺时针，蓝色表示逆时针）。

## 常见问题与排查

- **A 点越界**：检查输入坐标是否位于图像范围内。
- **环带参数非法**：确保 `outer_r > inner_r >= 0`。
- **无可走像素**：确认输入地图已正确加载且阈值分割结果为可走区域。
- **A 点被障碍包围**：需调整障碍布局或变更环带半径，否则 Dijkstra/A* 会报错提示。
- **输出图缺失**：请确认脚本具有写文件权限，或手动删除旧的 `demo_output.png` 后重试。

## 许可证

本示例仅用于演示用途，自由学习与修改。若在其他项目中引用，请注明来源。 
